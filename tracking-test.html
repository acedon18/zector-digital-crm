<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Tracking Script - Zector Digital</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; background: #007cba; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #005a85; }
        .log { background: #f5f5f5; padding: 10px; border-radius: 3px; font-family: monospace; font-size: 12px; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>Zector Digital - Test Tracking Script</h1>
    
    <div class="test-section">
        <h3>Manual Event Tests</h3>
        <button onclick="testPageView()">Test Page View</button>
        <button onclick="testButtonClick()">Test Button Click</button>
        <button onclick="testFormSubmit()">Test Form Submit</button>
        <button onclick="clearLog()">Clear Log</button>
    </div>
    
    <div class="test-section">
        <h3>Event Log</h3>
        <div id="eventLog" class="log">Tracking script loaded...\n</div>
    </div>

    <!-- Include the Zector Digital tracking script -->
    <script type="text/javascript">
    (function() {
      var zld = {
        customerId: 'ZECTOR_DIGITAL_ES',
        domain: 'zectordigital.es',
        scriptId: 'zld_' + Date.now(),
        config: {
          gdprCompliant: true,
          anonymizeIp: true,
          trackScrollDepth: true,
          trackDownloads: true,
          trackFormSubmissions: true
        }
      };

      // Override console.log to capture tracking calls
      var originalConsoleLog = console.log;
      var eventLog = function(message) {
        var logDiv = document.getElementById('eventLog');
        if (logDiv) {
          logDiv.textContent += new Date().toLocaleTimeString() + ': ' + message + '\n';
          logDiv.scrollTop = logDiv.scrollHeight;
        }
        originalConsoleLog(message);
      };

      // Tracking functions
      zld.track = function(event, data) {
        var payload = {
          event: event,
          data: data || {},
          timestamp: new Date().toISOString(),
          url: window.location.href,
          referrer: document.referrer,
          userAgent: navigator.userAgent,
          customerId: zld.customerId,
          domain: zld.domain
        };

        if (zld.config.anonymizeIp) {
          payload.anonymizeIp = true;
        }
        
        eventLog('Sending event: ' + event + ' to API');
        
        // Send to tracking endpoint (production)
        fetch('https://zector-digital-crm-leads.vercel.app/api/track', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(payload)
        }).then(function(response) {
          if (response.ok) {
            eventLog('‚úÖ Event ' + event + ' sent successfully');
            return response.json();
          } else {
            eventLog('‚ùå Event ' + event + ' failed: ' + response.status);
            throw new Error('Response not ok');
          }
        }).then(function(data) {
          eventLog('üìä Server response: ' + JSON.stringify(data));
        }).catch(function(error) {
          eventLog('üö® Tracking error: ' + error.message);
        });
      };

      // Auto-track page load
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          zld.track('page_view', {
            title: document.title,
            loadTime: Date.now()
          });
        });
      } else {
        zld.track('page_view', {
          title: document.title,
          loadTime: Date.now()
        });
      }

      // Make zld globally available for testing
      window.ZectorTracking = zld;
      
      eventLog('Tracking script initialized');
    })();

    // Test functions
    function testPageView() {
      window.ZectorTracking.track('page_view', {
        title: 'Manual Test Page View',
        source: 'manual_test'
      });
    }

    function testButtonClick() {
      window.ZectorTracking.track('button_click', {
        button_id: 'test_button',
        button_text: 'Test Button Click'
      });
    }

    function testFormSubmit() {
      window.ZectorTracking.track('form_submit', {
        form_id: 'test_form',
        form_type: 'contact'
      });
    }

    function clearLog() {
      document.getElementById('eventLog').textContent = '';
    }
    </script>
</body>
</html>
